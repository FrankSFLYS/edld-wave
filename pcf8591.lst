C51 COMPILER V9.01   PCF8591                                                               07/11/2018 18:21:46 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE PCF8591
NO OBJECT MODULE REQUESTED
COMPILER INVOKED BY: G:\Keil\k4\C51\BIN\C51.EXE src\pcf8591.c BROWSE DEBUG OBJECTEXTEND PRINT(.\pcf8591.lst) SRC(.\pcf85
                    -91.SRC)

line level    source

   1          /********å¼•ç”¨çš„å¤´æ–‡ä»¶*******/
   2          #include <reg52.h> //å¼€å‘51å•ç‰‡æœºå¿…é¡»åŒ…å«çš„å¤´æ–‡ä»¶,è¯¥æ–‡ä»¶å®šä¹‰äº†89c52å•ç‰‡æœºå†…éƒ¨å¯„å­
             -˜å™¨çš„åœ°å€
   3          #include "pcf8591.h" //pcf8591.hæ–‡ä»¶å£°æ˜äº†pcf8591.cæ–‡ä»¶é‡Œè¾¹çš„æ“ä½œå‡½æ•°,å¦‚æœä¸»å‡½æ•°è¦è°ƒç
             -”¨æ“ä½œå‡½æ•°,åˆ™éœ€åŒ…å«æ­¤å¤´æ–‡ä»¶
   4          #include <intrins.h> //åŒ…å«NOPç©ºæŒ‡ä»¤å‡½æ•°_nop_();
   5          /***********å®å®šä¹‰**********/
   6          #define uchar unsigned char
   7          #define uint  unsigned int
   8          #define AddWr 0x90   //å†™æ•°æ®åœ°å€ 
   9          #define AddRd 0x91   //è¯»æ•°æ®åœ°å€
  10          
  11          /********ç¡¬ä»¶æ¥å£å®šä¹‰*******/
  12          sbit     Sda=P2^0;      //I2C  æ—¶é’Ÿ 
  13          sbit     Scl=P2^1;      //I2C  æ•°æ® 
  14          
  15          /*------------------------------------------------
  16                              å¯åŠ¨IICæ€»çº¿
  17          ------------------------------------------------*/
  18          void Start(void)
  19          {
  20   1          Sda=1;
  21   1          _nop_();
  22   1          Scl=1;
  23   1          _nop_();
  24   1          Sda=0;
  25   1          _nop_();
  26   1          Scl=0;
  27   1      }
  28          
  29          /*------------------------------------------------
  30                             åº”ç­”IICæ€»çº¿
  31          ------------------------------------------------*/
  32          void Ack(void)
  33          {
  34   1          Sda=0;
  35   1          _nop_();
  36   1          Scl=1;
  37   1          _nop_();
  38   1          Scl=0;
  39   1          _nop_();
  40   1      }
  41          
  42          /*------------------------------------------------
  43                        å‘é€ä¸€ä¸ªå­—èŠ‚
  44          ------------------------------------------------*/
  45          void Send(unsigned char Data)
  46          { 
  47   1          unsigned char BitCounter=8;
  48   1          unsigned char temp;
  49   1      
  50   1          do {
  51   2              temp=Data;
  52   2              Scl=0;
C51 COMPILER V9.01   PCF8591                                                               07/11/2018 18:21:46 PAGE 2   

  53   2              _nop_();
  54   2              if((temp&0x80)==0x80)
  55   2                  Sda=1;
  56   2              else
  57   2                  Sda=0;
  58   2      
  59   2              Scl=1;
  60   2              temp=Data<<1;
  61   2              Data=temp;
  62   2              BitCounter--;
  63   2          } while(BitCounter);
  64   1          Scl=0;
  65   1      }
  66          
  67          void DACStart() {
  68   1          Start();
  69   1          Send(AddWr); //å†™å…¥èŠ¯ç‰‡åœ°å€
  70   1          Ack();
  71   1          Send(0x40);  //å†™å…¥æ§åˆ¶ä½ï¼Œä½¿èƒ½DACè¾“å‡º
  72   1          Ack();
  73   1      }
  74          
  75          void SendNextData(unsigned char Data) {
  76   1          // Send(Data);
  77   1          // Ack();
  78   1          #pragma asm
  79   1              IMPORT Data
  80   1              MOV     R0, Data
  81   1      
  82   1          #pragma endsam
*** WARNING C245 IN LINE 82 OF SRC\PCF8591.C: unknown #pragma, line ignored
  83   1      }
  84   1      
  85   1      void ContinuesSend(unsigned char Data) {
  86   1          Send(Data);
  87   1          Ack();
  88   1      }
*** ERROR C141 IN LINE 88 OF SRC\PCF8591.C: syntax error near ''

C51 COMPILATION COMPLETE.  1 WARNING(S),  1 ERROR(S)
